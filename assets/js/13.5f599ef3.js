(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{623:function(s,t,a){s.exports=a.p+"assets/img/img_12.9607a532.png"},624:function(s,t,a){s.exports=a.p+"assets/img/img_5.d078a28f.png"},625:function(s,t,a){s.exports=a.p+"assets/img/img_6.2cabfbf7.png"},626:function(s,t,a){s.exports=a.p+"assets/img/img_7.c71e17a9.png"},627:function(s,t,a){s.exports=a.p+"assets/img/img_8.56d404dc.png"},628:function(s,t,a){s.exports=a.p+"assets/img/img_9.e5064f6b.png"},629:function(s,t,a){s.exports=a.p+"assets/img/img_10.7072e594.png"},630:function(s,t,a){s.exports=a.p+"assets/img/img_11.90ef7290.png"},787:function(s,t,a){"use strict";a.r(t);var n=a(5),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"gitlab-ci介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci介绍"}},[s._v("#")]),s._v(" GitLab-CI介绍")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://docs.gitlab.cn/ee/ci/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方介绍"),n("OutboundLink")],1)]),s._v(" "),n("h1",{attrs:{id:"gitlab-ci-yml语法介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci-yml语法介绍"}},[s._v("#")]),s._v(" .gitlab-ci.yml语法介绍")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://docs.gitlab.cn/ee/ci/yaml/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方.gitlab-ci.yml说明"),n("OutboundLink")],1)]),s._v(" "),n("h1",{attrs:{id:"创建springboot项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建springboot项目"}},[s._v("#")]),s._v(" 创建SpringBoot项目")]),s._v(" "),n("h1",{attrs:{id:"使用google的jib插件构建docker镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用google的jib插件构建docker镜像"}},[s._v("#")]),s._v(" 使用Google的Jib插件构建docker镜像")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/GoogleContainerTools/jib/tree/v2.0.0-gradle/jib-gradle-plugin#quickstart",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),n("OutboundLink")],1)]),s._v(" "),n("div",{staticClass:"language-kotlin line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-kotlin"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jetbrains"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kotlin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gradle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tasks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("KotlinCompile\n\nplugins "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 引入Google的Jib插件")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.google.cloud.tools.jib"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" version "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.3.1"')]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"org.springframework.boot"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" version "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2.6.8"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.spring.dependency-management"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" version "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.11.RELEASE"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kotlin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jvm"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" version "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.6.21"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kotlin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plugin.spring"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" version "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.6.21"')]),s._v("\n    java\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\napply"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("JavaPlugin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\napply"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("JavaLibraryPlugin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\ngroup "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.wry"')]),s._v("\nversion "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.1-SNAPSHOT"')]),s._v("\njava"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sourceCompatibility "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" JavaVersion"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("VERSION_1_8\n\nrepositories "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 阿里云")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("maven")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://maven.aliyun.com/repository/public/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mavenCentral")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\ndependencies "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("implementation")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"org.springframework.boot:spring-boot-starter-web"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("implementation")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.fasterxml.jackson.module:jackson-module-kotlin"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("implementation")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"org.jetbrains.kotlin:kotlin-reflect"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("implementation")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"org.jetbrains.kotlin:kotlin-stdlib-jdk8"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("testImplementation")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"org.springframework.boot:spring-boot-starter-test"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 配置构建镜像的基本信息")]),s._v("\nconfigure"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("google"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tools"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gradle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("JibExtension"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setAllowInsecureRegistries")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    from "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        image "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"openjdk:8"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        image "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wry/'),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token delimiter variable"}},[s._v("${")]),s._v("project"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token delimiter variable"}},[s._v("}")])]),s._v('"')]),s._v("\n        tags "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mutableSetOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"latest"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    container "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        appRoot "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app"')]),s._v("\n        workingDirectory "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app"')]),s._v("\n        jvmFlags "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mutableListOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Dspring.backgroundpreinitializer.ignore=true"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// spring优化线程")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Duser.timezone=Asia/Shanghai"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Dproject.name='),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token delimiter variable"}},[s._v("${")]),s._v("project"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token delimiter variable"}},[s._v("}")])]),s._v('"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        ports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mutableListOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8080"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\ntasks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("withType"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("KotlinCompile"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    kotlinOptions "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        freeCompilerArgs "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("listOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Xjsr305=strict"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        jvmTarget "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.8"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\ntasks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("withType"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Test"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("useJUnitPlatform")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br")])]),n("h1",{attrs:{id:"编写-gitlab-ci-yml"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编写-gitlab-ci-yml"}},[s._v("#")]),s._v(" 编写.gitlab-ci.yml")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" openjdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自定义阶段")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" build\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" deploy\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 项目构建docker image压缩文件阶段")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" openjdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" chmod +x gradlew\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" CURRENT_PATH=$PWD\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "当前路径：$CURRENT_PATH"\n    '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./gradlew jibDockerBuild\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署阶段")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deploy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deploy\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "部署项目"\n    '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker stop test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("boot\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rm test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("boot\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker run "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("itd "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("restart=always "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p 8081"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8080 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("boot wry/test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("boot\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("h1",{attrs:{id:"使用常见的docker-runner执行器运行ci"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用常见的docker-runner执行器运行ci"}},[s._v("#")]),s._v(" 使用常见的"),n("code",[s._v("Docker-runner")]),s._v("执行器运行CI")]),s._v(" "),n("h2",{attrs:{id:"执行ci过程中出现错误"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#执行ci过程中出现错误"}},[s._v("#")]),s._v(" 执行CI过程中出现错误")]),s._v(" "),n("p",[n("img",{attrs:{src:a(623),alt:"image.png"}})]),s._v(" "),n("h2",{attrs:{id:"错误原因"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#错误原因"}},[s._v("#")]),s._v(" 错误原因")]),s._v(" "),n("p",[n("code",[s._v("GitLab-CI")]),s._v("执行器是"),n("code",[s._v("docker")]),s._v(",跑任务的时候会启动一个"),n("code",[s._v("docker")]),s._v("容器， 容器内部没有"),n("code",[s._v("docker")]),s._v("环境，所以找不到docker 守护进程**")]),s._v(" "),n("h2",{attrs:{id:"解决办法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决办法"}},[s._v("#")]),s._v(" 解决办法")]),s._v(" "),n("p",[s._v("翻阅GitLab官方文档,看到GitLab-runner有一个Docker-In-Docker模式，可以在容器中使用docker环境\n"),n("a",{attrs:{href:"https://docs.gitlab.cn/jh/ci/docker/using_docker_build.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方链接"),n("OutboundLink")],1)]),s._v(" "),n("h1",{attrs:{id:"注册docker-in-docker模式的gitlab-runner"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注册docker-in-docker模式的gitlab-runner"}},[s._v("#")]),s._v(" 注册Docker-In-Docker模式的GitLab-runner")]),s._v(" "),n("h2",{attrs:{id:"查看docker版本信息"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看docker版本信息"}},[s._v("#")]),s._v(" 查看docker版本信息")]),s._v(" "),n("p",[s._v("查看宿主机"),n("code",[s._v("docker")]),s._v("版本信息")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("docker version\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("img",{attrs:{src:a(624),alt:"image.png"}})]),s._v(" "),n("h2",{attrs:{id:"注册gitlab-runner"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注册gitlab-runner"}},[s._v("#")]),s._v(" 注册GitLab-Runner")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose exec <compose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" gitlab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("runner register "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("n \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('url "<url'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v('" \\\n  '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("registration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('token "<token'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v('" \\\n  '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("executor docker \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('description "Docker In Docker Runner" \\\n  '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('image "docker'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('20.10.22" \\\n  '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("privileged \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("tag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('list "docker'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("in"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('docker" \n  \n  '),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 例子")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker-compose exec gitlab-runner gitlab-runner register -n \\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# --url "http://120.76.142.218" \\')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# --registration-token "RB3asxbMJMv3GXXX" \\')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --executor docker \\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# --description "Docker In Docker Runner" \\')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# --docker-image "docker:20.10.22" \\')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --docker-privileged \\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# --tag-list "docker-in-docker" ')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h2",{attrs:{id:"查看结果"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看结果"}},[s._v("#")]),s._v(" 查看结果")]),s._v(" "),n("p",[s._v("http://IP:PORT/admin/runners")]),s._v(" "),n("p",[n("img",{attrs:{src:a(625),alt:"image.png"}})]),s._v(" "),n("h1",{attrs:{id:"修改-gitlab-ci-yml文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改-gitlab-ci-yml文件"}},[s._v("#")]),s._v(" 修改"),n("code",[s._v(".gitlab-ci.yml")]),s._v("文件")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("20.10.22\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("in"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("docker\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("DOCKER_HOST")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//120.76.142.218"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2375")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("20.10.22"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dind\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" build\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" deploy\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" chmod +x gradlew\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" CURRENT_PATH=$PWD\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "当前路径：$CURRENT_PATH"\n    '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker version\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./gradlew jibDockerBuild\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deploy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deploy\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "部署项目"\n    '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker stop test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("boot\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rm test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("boot\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker run "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("itd "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("restart=always "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p 8081"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8080 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("boot wry/test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("boot\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("h1",{attrs:{id:"docker环境无java环境错误"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker环境无java环境错误"}},[s._v("#")]),s._v(" docker环境无java环境错误")]),s._v(" "),n("p",[s._v("注册新的"),n("code",[s._v("GitLab-runner")]),s._v("后，发现在"),n("code",[s._v("docker")]),s._v("环境下无法使用"),n("code",[s._v("gradlew")]),s._v("进行docker镜像构建，\n缺少"),n("code",[s._v("JAVA")]),s._v("环境\n"),n("img",{attrs:{src:a(626),alt:"image.png"}})]),s._v(" "),n("h2",{attrs:{id:"解决办法-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决办法-2"}},[s._v("#")]),s._v(" 解决办法")]),s._v(" "),n("h3",{attrs:{id:"把java环境和docker环境分开-模式一"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#把java环境和docker环境分开-模式一"}},[s._v("#")]),s._v(" 把java环境和docker环境分开 （模式一)")]),s._v(" "),n("ul",[n("li",[s._v("在java环境下把项目构建成docker镜像压缩包")]),s._v(" "),n("li",[s._v("在docker环境下还原docker镜像压缩包")])]),s._v(" "),n("h3",{attrs:{id:"先安装java环境再安装docker环境-模式二"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#先安装java环境再安装docker环境-模式二"}},[s._v("#")]),s._v(" 先安装JAVA环境再安装docker环境（模式二)")]),s._v(" "),n("ul",[n("li",[s._v("在java环境下安装docker使其连接宿主机docker环境")])]),s._v(" "),n("p",[n("a",{attrs:{href:"https://stackoverflow.com/questions/71109409/gitlab-ci-docker-inside-java-image",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://stackoverflow.com/questions/71109409/gitlab-ci-docker-inside-java-image"),n("OutboundLink")],1)]),s._v(" "),n("h1",{attrs:{id:"修改-gitlab-ci-yml文件-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改-gitlab-ci-yml文件-2"}},[s._v("#")]),s._v(" 修改"),n("code",[s._v(".gitlab-ci.yml")]),s._v("文件")]),s._v(" "),n("p",[n("code",[s._v("docker-in-docker")]),s._v("模式"),n("code",[s._v(".gitlab-ci.yml")]),s._v(" "),n("a",{attrs:{href:"https://docs.gitlab.cn/jh/ci/docker/using_docker_build.html#%E4%BD%BF%E7%94%A8-docker-in-docker",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方推荐写法"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"模式一"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#模式一"}},[s._v("#")]),s._v(" 模式一")]),s._v(" "),n("p",[n("strong",[s._v("把java环境和docker环境分开")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 官方定义写法")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("20.10.22\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("in"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("docker\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("DOCKER_HOST")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//120.76.142.218"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2375")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("20.10.22"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dind\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自定义阶段")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" build\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("image\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" deploy\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用缓存，避免每次执行Job都下载依赖")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cache")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" build  \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" .gradle/wrapper\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" .gradle/caches\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前置阶段，输出docker信息")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("echo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .pre\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker info\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 项目构建docker image压缩文件阶段")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" openjdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" chmod +x gradlew\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" CURRENT_PATH=$PWD\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "当前路径：$CURRENT_PATH"\n    '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./gradlew jibBuildTar\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker 还原image压缩文件阶段")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("docker-image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("image\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" CURRENT_PATH=$PWD\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "当前路径：$CURRENT_PATH"\n    '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker load "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("input build/jib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("image.tar\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署阶段")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deploy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deploy\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "部署项目"\n    '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker stop test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("boot\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rm test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("boot\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker run "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("itd "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("restart=always "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p 8081"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8080 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("boot wry/test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("boot\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br")])]),n("h2",{attrs:{id:"模式二"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#模式二"}},[s._v("#")]),s._v(" 模式二")]),s._v(" "),n("p",[n("strong",[s._v("先安装JAVA环境再安装docker环境")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("20.10.22\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("in"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("docker\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("DOCKER_HOST")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//120.76.142.218"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2375")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("20.10.22"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dind\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" build\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" deploy\n\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("echo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .pre\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker info\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" gradle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("jdk8  \n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("20.10.22"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dind\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("DOCKER_HOST")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//120.76.142.218"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2375")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("before_script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" apt update "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" apt install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("install"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("recommends "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y docker.io \n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" chmod +x gradlew\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" CURRENT_PATH=$PWD\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "当前路径：$CURRENT_PATH"\n    '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker version\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./gradlew jibDockerBuild\n\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deploy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deploy\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "部署项目"\n    '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker stop test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("boot\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rm test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("boot\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker run "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("itd "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("restart=always "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p 8081"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8080 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("boot wry/test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("boot\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br")])]),n("h1",{attrs:{id:"运行ci"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#运行ci"}},[s._v("#")]),s._v(" 运行CI")]),s._v(" "),n("p",[n("img",{attrs:{src:a(627),alt:"image.png"}}),s._v(" "),n("img",{attrs:{src:a(628),alt:"image.png"}})]),s._v(" "),n("h1",{attrs:{id:"查看运行的docker容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看运行的docker容器"}},[s._v("#")]),s._v(" 查看运行的docker容器")]),s._v(" "),n("p",[n("img",{attrs:{src:a(629),alt:"image.png"}})]),s._v(" "),n("h1",{attrs:{id:"测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),n("p",[n("img",{attrs:{src:a(630),alt:"image.png"}})])])}),[],!1,null,null,null);t.default=e.exports}}]);